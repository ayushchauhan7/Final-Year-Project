<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brain Tumor Detection System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f8f9fa;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .card {
            border-radius: 15px;
            margin-bottom: 20px;
        }

        #results img, #api-results img, #debug-results img {
            max-height: 400px;
            margin-top: 15px;
        }

        .text-center {
            text-align: center;
        }

        .btn {
            width: 100%;
            margin-bottom: 10px;
        }

        .lead {
            margin-bottom: 30px;
        }

        .api-section {
            border-left: 4px solid #007bff;
            padding-left: 15px;
        }

        .debug-section {
            border-left: 4px solid #28a745;
            padding-left: 15px;
        }

        .json-output {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .nav-tabs .nav-link.active {
            background-color: #007bff;
            color: white;
        }
    </style>
</head>

<body>
    <div class="container mt-5">
        <div class="text-center">
            <h1 class="display-4 text-primary">Brain Tumor Detection System</h1>
            <p class="lead text-secondary">Comprehensive test interface for all endpoints</p>
        </div>

        <!-- Navigation Tabs -->
        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="web-tab" data-bs-toggle="tab" data-bs-target="#web" type="button">Web Interface</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="api-tab" data-bs-toggle="tab" data-bs-target="#api" type="button">API Predict</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="debug-tab" data-bs-toggle="tab" data-bs-target="#debug" type="button">Debug API</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="batch-tab" data-bs-toggle="tab" data-bs-target="#batch" type="button">Batch API</button>
            </li>
            <!-- Add this new tab in the navigation -->
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="results-tab" data-bs-toggle="tab" data-bs-target="#results" type="button">Research Results</button>
            </li>
        </ul>

        <div class="tab-content" id="myTabContent">
            <!-- Web Interface Tab -->
            <div class="tab-pane fade show active" id="web" role="tabpanel">
                <div class="card shadow p-4 mt-4">
                    <h4 class="text-primary">Standard Web Upload</h4>
                    <p class="text-muted">Traditional form submission with page reload</p>
                    <form method="POST" enctype="multipart/form-data">
                        <div class="mb-3">
                            <label for="file" class="form-label">Select MRI Image:</label>
                            <input type="file" class="form-control" id="file" name="file" accept="image/*" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Upload and Detect</button>
                    </form>
                </div>

                {% if result %}
                <div id="results" class="mt-4">
                    <div class="card shadow">
                        <div class="card-body">
                            <h4 class="card-title text-success">{{ result }}</h4>
                            <p class="card-text text-muted">Confidence: {{ confidence }}</p>
                            <img src="{{ file_path }}" class="img-fluid rounded" alt="Uploaded Image">
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>

            <!-- API Predict Tab -->
            <div class="tab-pane fade" id="api" role="tabpanel">
                <div class="card shadow p-4 mt-4 api-section">
                    <h4 class="text-primary">API Predict Endpoint</h4>
                    <p class="text-muted">Test <code>/api/predict</code> endpoint with AJAX</p>
                    <form id="api-form">
                        <div class="mb-3">
                            <label for="api-file" class="form-label">Select MRI Image:</label>
                            <input type="file" class="form-control" id="api-file" accept="image/*" required>
                        </div>
                        <button type="button" class="btn btn-info" onclick="testApiPredict()">
                            <span id="api-spinner" class="spinner-border spinner-border-sm d-none"></span>
                            Test API Predict
                        </button>
                    </form>
                </div>

                <!-- API Results -->
                <div id="api-results" class="mt-4" style="display: none;">
                    <div class="card shadow">
                        <div class="card-body">
                            <h4 class="card-title text-info">API Response</h4>
                            <div id="api-json" class="json-output"></div>
                            <div id="api-image-preview" class="mt-3"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Debug API Tab -->
            <div class="tab-pane fade" id="debug" role="tabpanel">
                <div class="card shadow p-4 mt-4 debug-section">
                    <h4 class="text-success">Debug Prediction Endpoint</h4>
                    <p class="text-muted">Test <code>/api/debug/prediction</code> with detailed analysis</p>
                    <form id="debug-form">
                        <div class="mb-3">
                            <label for="debug-file" class="form-label">Select MRI Image:</label>
                            <input type="file" class="form-control" id="debug-file" accept="image/*" required>
                        </div>
                        <button type="button" class="btn btn-success" onclick="testDebugPredict()">
                            <span id="debug-spinner" class="spinner-border spinner-border-sm d-none"></span>
                            Test Debug Prediction
                        </button>
                    </form>
                </div>

                <!-- Debug Results -->
                <div id="debug-results" class="mt-4" style="display: none;">
                    <div class="card shadow">
                        <div class="card-body">
                            <h4 class="card-title text-success">Debug Response</h4>
                            <div id="debug-json" class="json-output"></div>
                            <div id="debug-image-preview" class="mt-3"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Batch API Tab -->
            <div class="tab-pane fade" id="batch" role="tabpanel">
                <div class="card shadow p-4 mt-4" style="border-left: 4px solid #fd7e14;">
                    <h4 class="text-warning">📚 Batch Prediction Endpoint</h4>
                    <p class="text-muted">Test <code>/api/predict/batch</code> endpoint with multiple images</p>
                    <form id="batch-form">
                        <div class="mb-3">
                            <label for="batch-files" class="form-label">Select Multiple MRI Images:</label>
                            <input type="file" class="form-control" id="batch-files" accept="image/*" multiple required>
                            <small class="text-muted">Hold Ctrl/Cmd to select multiple images</small>
                        </div>
                        <button type="button" class="btn btn-warning" onclick="testBatchPredict()">
                            <span id="batch-spinner" class="spinner-border spinner-border-sm d-none"></span>
                            Test Batch Prediction
                        </button>
                    </form>
                </div>

                <!-- Batch Results -->
                <div id="batch-results" class="mt-4" style="display: none;">
                    <div class="card shadow">
                        <div class="card-body">
                            <h4 class="card-title text-warning">📊 Batch Response</h4>
                            <div id="batch-json" class="json-output"></div>
                            <div id="batch-image-preview" class="mt-3"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Research Results Tab (Newly Added) -->
            <div class="tab-pane fade" id="results" role="tabpanel">
                <div class="card shadow p-4 mt-4" style="border-left: 4px solid #28a745;">
                    <h4 class="text-success">📊 Research Results & Analytics</h4>
                    <p class="text-muted">Test research endpoints for charts and statistical analysis</p>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <h5>📈 Charts Generation</h5>
                            <p><code>/api/results/charts</code> - Generate research visualizations</p>
                            <button type="button" class="btn btn-success" onclick="testChartsGeneration()">
                                <span id="charts-spinner" class="spinner-border spinner-border-sm d-none"></span>
                                Generate Research Charts
                            </button>
                        </div>
                        <div class="col-md-6">
                            <h5>📊 Statistical Analysis</h5>
                            <p><code>/api/results/statistics</code> - Get detailed statistics</p>
                            <button type="button" class="btn btn-info" onclick="testStatisticsGeneration()">
                                <span id="stats-spinner" class="spinner-border spinner-border-sm d-none"></span>
                                Generate Statistics
                            </button>
                        </div>
                    </div>
                    
                    <div class="mt-3">
                        <small class="text-muted">
                            <strong>Note:</strong> These endpoints generate research-ready charts and statistics based on your prediction history. 
                            Make sure you have made some predictions first using the other tabs.
                        </small>
                    </div>
                </div>

                <!-- Charts Results -->
                <div id="charts-results" class="mt-4" style="display: none;">
                    <div class="card shadow">
                        <div class="card-body">
                            <h4 class="card-title text-success">📊 Generated Charts</h4>
                            <div id="charts-display" class="row"></div>
                            <div class="mt-3">
                                <h5>Raw JSON Response:</h5>
                                <div id="charts-json" class="json-output"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Statistics Results -->
                <div id="statistics-results" class="mt-4" style="display: none;">
                    <div class="card shadow">
                        <div class="card-body">
                            <h4 class="card-title text-info">📈 Statistical Analysis</h4>
                            <div id="statistics-json" class="json-output"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick API Info -->
        <div class="card shadow p-4 mt-4">
            <h5 class="text-secondary">Quick API Reference</h5>
            <div class="row">
                <div class="col-md-4">
                    <strong>Standard Endpoints:</strong>
                    <ul class="list-unstyled mt-2">
                        <li><code>GET /</code> - API Documentation</li>
                        <li><code>GET /api/health</code> - Health Check</li>
                        <li><code>GET /api/classes</code> - Available Classes</li>
                        <li><code>GET /api/model/info</code> - Model Info</li>
                        <li><code>GET /api/analytics/summary</code> - Analytics</li>
                        <li><code>GET /api/predictions/history</code> - History</li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <strong>POST Endpoints:</strong>
                    <ul class="list-unstyled mt-2">
                        <li><code>POST /api/predict</code> - Single Image</li>
                        <li><code>POST /api/predict/batch</code> - Multiple Images</li>
                        <li><code>POST /api/debug/prediction</code> - Debug Analysis</li>
                    </ul>
                    <strong>Research Endpoints:</strong> <!-- New -->
                    <ul class="list-unstyled mt-2">
                        <li><code>GET /api/results/charts</code> - Research Charts</li>
                        <li><code>GET /api/results/statistics</code> - Statistics</li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <strong>Test These Endpoints:</strong>
                    <div class="d-grid gap-1">
                        <button class="btn btn-sm btn-outline-primary" onclick="testEndpoint('/api/health')">Test Health</button>
                        <button class="btn btn-sm btn-outline-primary" onclick="testEndpoint('/api/classes')">Test Classes</button>
                        <button class="btn btn-sm btn-outline-primary" onclick="testEndpoint('/api/model/info')">Test Model Info</button>
                        <button class="btn btn-sm btn-outline-success" onclick="testEndpoint('/api/results/statistics')">Test Statistics</button> <!-- New -->
                        <button class="btn btn-sm btn-outline-info" onclick="testChartsGeneration()">Generate Charts</button> <!-- New -->
                    </div>
                </div>
            </div>
            <div id="quick-test-results" class="mt-3" style="display: none;">
                <div class="json-output" id="quick-json"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Test API Predict endpoint
        function testApiPredict() {
            const fileInput = document.getElementById('api-file');
            const spinner = document.getElementById('api-spinner');
            const resultsDiv = document.getElementById('api-results');
            const jsonDiv = document.getElementById('api-json');
            const imageDiv = document.getElementById('api-image-preview');

            if (!fileInput.files[0]) {
                alert('Please select an image file first!');
                return;
            }

            // Show loading
            spinner.classList.remove('d-none');
            
            const formData = new FormData();
            formData.append('image', fileInput.files[0]);

            fetch('/api/predict', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                // Hide loading
                spinner.classList.add('d-none');
                
                // Show results
                resultsDiv.style.display = 'block';
                jsonDiv.textContent = JSON.stringify(data, null, 2);
                
                // Show image preview
                const reader = new FileReader();
                reader.onload = function(e) {
                    imageDiv.innerHTML = `<img src="${e.target.result}" class="img-fluid rounded" alt="Uploaded Image" style="max-height: 300px;">`;
                };
                reader.readAsDataURL(fileInput.files[0]);
            })
            .catch(error => {
                spinner.classList.add('d-none');
                jsonDiv.textContent = `Error: ${error.message}`;
                resultsDiv.style.display = 'block';
            });
        }

        // Test Debug Prediction endpoint
        function testDebugPredict() {
            const fileInput = document.getElementById('debug-file');
            const spinner = document.getElementById('debug-spinner');
            const resultsDiv = document.getElementById('debug-results');
            const jsonDiv = document.getElementById('debug-json');
            const imageDiv = document.getElementById('debug-image-preview');

            if (!fileInput.files[0]) {
                alert('Please select an image file first!');
                return;
            }

            // Show loading
            spinner.classList.remove('d-none');
            
            const formData = new FormData();
            formData.append('image', fileInput.files[0]);

            fetch('/api/debug/prediction', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                // Hide loading
                spinner.classList.add('d-none');
                
                // Show results
                resultsDiv.style.display = 'block';
                jsonDiv.textContent = JSON.stringify(data, null, 2);
                
                // Show image preview
                const reader = new FileReader();
                reader.onload = function(e) {
                    imageDiv.innerHTML = `<img src="${e.target.result}" class="img-fluid rounded" alt="Uploaded Image" style="max-height: 300px;">`;
                };
                reader.readAsDataURL(fileInput.files[0]);
            })
            .catch(error => {
                spinner.classList.add('d-none');
                jsonDiv.textContent = `Error: ${error.message}`;
                resultsDiv.style.display = 'block';
            });
        }

        // Enhanced Batch Prediction with Image Previews
        function testBatchPredict() {
            const fileInput = document.getElementById('batch-files');
            const spinner = document.getElementById('batch-spinner');
            const resultsDiv = document.getElementById('batch-results');
            const jsonDiv = document.getElementById('batch-json');
            const imageDiv = document.getElementById('batch-image-preview');

            if (!fileInput.files || fileInput.files.length === 0) {
                alert('Please select multiple image files first!');
                return;
            }

            // Show loading
            spinner.classList.remove('d-none');
            
            // Show image previews immediately while processing
            showImagePreviews(fileInput.files, imageDiv);
            
            const formData = new FormData();
            
            // Append all selected files
            for (let i = 0; i < fileInput.files.length; i++) {
                formData.append('images', fileInput.files[i]);
            }

            fetch('/api/predict/batch', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                // Hide loading
                spinner.classList.add('d-none');
                
                // Show results
                resultsDiv.style.display = 'block';
                jsonDiv.textContent = JSON.stringify(data, null, 2);
                
                // Update images with results
                showImagePreviewsWithResults(fileInput.files, data, imageDiv);
            })
            .catch(error => {
                spinner.classList.add('d-none');
                jsonDiv.textContent = `Error: ${error.message}`;
                resultsDiv.style.display = 'block';
                
                // Show error
                imageDiv.innerHTML = `
                    <div class="alert alert-danger">
                        <h6>❌ Error processing images</h6>
                        <p>${error.message}</p>
                    </div>
                `;
            });
        }

        // Helper function to show image previews
        function showImagePreviews(files, containerDiv) {
            let previewHtml = `
                <h6>Processing ${files.length} images...</h6>
                <div class="row" id="image-preview-container">
            `;
            
            containerDiv.innerHTML = previewHtml;
            
            const maxPreviews = Math.min(files.length, 6);
            let loadedCount = 0;
            
            for (let i = 0; i < maxPreviews; i++) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imageHtml = `
                        <div class="col-md-4 col-sm-6 mb-3" id="image-${i}">
                            <div class="card">
                                <img src="${e.target.result}" class="card-img-top" style="height: 150px; object-fit: cover;">
                                <div class="card-body p-2">
                                    <h6 class="card-title text-truncate" style="font-size: 0.8rem;">${files[i].name}</h6>
                                    <p class="card-text">
                                        <small class="text-muted">${(files[i].size / 1024).toFixed(1)} KB</small><br>
                                        <span class="badge bg-warning">Processing...</span>
                                    </p>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    document.getElementById('image-preview-container').innerHTML += imageHtml;
                    
                    loadedCount++;
                    if (loadedCount === maxPreviews) {
                        if (files.length > maxPreviews) {
                            document.getElementById('image-preview-container').innerHTML += `
                                <div class="col-12">
                                    <small class="text-muted">... and ${files.length - maxPreviews} more images</small>
                                </div>
                            `;
                        }
                        containerDiv.innerHTML += '</div>';
                    }
                };
                reader.readAsDataURL(files[i]);
            }
        }

        // Helper function to show previews with results
        function showImagePreviewsWithResults(files, apiResponse, containerDiv) {
            let previewHtml = `
                <h6>✅ Processed ${files.length} images - Results:</h6>
                <div class="row mb-3">
                    <div class="col-md-4">
                        <div class="alert alert-info p-2">
                            <strong>Total:</strong> ${apiResponse.total_images || files.length}
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="alert alert-danger p-2">
                            <strong>Tumors:</strong> ${apiResponse.batch_summary?.tumor_detected || 0}
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="alert alert-success p-2">
                            <strong>Normal:</strong> ${apiResponse.batch_summary?.no_tumor || 0}
                        </div>
                    </div>
                </div>
                <div class="row" id="result-preview-container">
            `;
            
            containerDiv.innerHTML = previewHtml;
            
            const maxPreviews = Math.min(files.length, 6);
            let loadedCount = 0;
            
            for (let i = 0; i < maxPreviews; i++) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    // Find corresponding result
                    const result = apiResponse.results ? apiResponse.results.find(r => r.filename === files[i].name) : null;
                    const prediction = result ? result.prediction : 'Unknown';
                    const confidence = result ? result.confidence : 'N/A';
                    const isTumor = prediction.includes('Tumor') && !prediction.includes('No Tumor');
                    
                    const imageHtml = `
                        <div class="col-md-4 col-sm-6 mb-3">
                            <div class="card ${isTumor ? 'border-danger' : 'border-success'}">
                                <img src="${e.target.result}" class="card-img-top" style="height: 150px; object-fit: cover;">
                                <div class="card-body p-2">
                                    <h6 class="card-title text-truncate" style="font-size: 0.8rem;" title="${files[i].name}">
                                        ${files[i].name}
                                </h6>
                                    <p class="card-text">
                                        <span class="badge ${isTumor ? 'bg-danger' : 'bg-success'}" style="font-size: 0.7rem;">
                                            ${prediction}
                                        </span><br>
                                        <small class="text-muted">Confidence: ${confidence}</small><br>
                                        <small class="text-muted">${(files[i].size / 1024).toFixed(1)} KB</small>
                                    </p>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    document.getElementById('result-preview-container').innerHTML += imageHtml;
                    
                    loadedCount++;
                    if (loadedCount === maxPreviews) {
                        if (files.length > maxPreviews) {
                            document.getElementById('result-preview-container').innerHTML += `
                                <div class="col-12">
                                    <div class="alert alert-info">
                                        <small>Showing first ${maxPreviews} of ${files.length} processed images. All results are included in the JSON response above.</small>
                                    </div>
                                </div>
                            `;
                        }
                        containerDiv.innerHTML += '</div>';
                    }
                };
                reader.readAsDataURL(files[i]);
            }
        }

        // Test other endpoints
        function testEndpoint(endpoint) {
            const resultsDiv = document.getElementById('quick-test-results');
            const jsonDiv = document.getElementById('quick-json');

            fetch(endpoint)
            .then(response => response.json())
            .then(data => {
                resultsDiv.style.display = 'block';
                jsonDiv.textContent = JSON.stringify(data, null, 2);
            })
            .catch(error => {
                resultsDiv.style.display = 'block';
                jsonDiv.textContent = `Error: ${error.message}`;
            });
        }

        // Test Charts Generation
        function testChartsGeneration() {
            const spinner = document.getElementById('charts-spinner');
            const resultsDiv = document.getElementById('charts-results');
            const chartsDisplay = document.getElementById('charts-display');
            const jsonDiv = document.getElementById('charts-json');

            // Show loading
            spinner.classList.remove('d-none');
            
            fetch('/api/results/charts')
            .then(response => response.json())
            .then(data => {
                // Hide loading
                spinner.classList.add('d-none');
                
                // Show results
                resultsDiv.style.display = 'block';
                jsonDiv.textContent = JSON.stringify(data, null, 2);
                
                // Display charts if available
                if (data.charts) {
                    let chartsHtml = '';
                    Object.entries(data.charts).forEach(([chartName, chartBase64]) => {
                        const chartTitle = chartName.replace(/_/g, ' ').toUpperCase();
                        chartsHtml += `
                            <div class="col-md-6 mb-4">
                                <div class="card">
                                    <div class="card-header bg-success text-white">
                                        <h6 class="mb-0">${chartTitle}</h6>
                                    </div>
                                    <div class="card-body text-center">
                                        <img src="data:image/png;base64,${chartBase64}" 
                                             class="img-fluid" 
                                             alt="${chartTitle}"
                                             style="max-height: 300px; cursor: pointer;"
                                             onclick="openImageModal('${chartBase64}', '${chartTitle}')">
                                        <br>
                                        <small class="text-muted">Click to enlarge</small>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    chartsDisplay.innerHTML = chartsHtml;
                }
            })
            .catch(error => {
                spinner.classList.add('d-none');
                jsonDiv.textContent = `Error: ${error.message}`;
                resultsDiv.style.display = 'block';
            });
        }

        // Test Statistics Generation
        function testStatisticsGeneration() {
            const spinner = document.getElementById('stats-spinner');
            const resultsDiv = document.getElementById('statistics-results');
            const jsonDiv = document.getElementById('statistics-json');

            // Show loading
            spinner.classList.remove('d-none');
            
            fetch('/api/results/statistics')
            .then(response => response.json())
            .then(data => {
                // Hide loading
                spinner.classList.add('d-none');
                
                // Show results
                resultsDiv.style.display = 'block';
                jsonDiv.textContent = JSON.stringify(data, null, 2);
            })
            .catch(error => {
                spinner.classList.add('d-none');
                jsonDiv.textContent = `Error: ${error.message}`;
                resultsDiv.style.display = 'block';
            });
        }

        // Helper function to open image in modal (for chart enlargement)
        function openImageModal(base64Data, title) {
            // Create modal HTML
            const modalHtml = `
                <div class="modal fade" id="chartModal" tabindex="-1">
                    <div class="modal-dialog modal-xl">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">${title}</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body text-center">
                                <img src="data:image/png;base64,${base64Data}" class="img-fluid" alt="${title}">
                            </div>
                            <div class="modal-footer">
                                <a href="data:image/png;base64,${base64Data}" download="${title}.png" class="btn btn-success">
                                    Download Chart
                                </a>
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Remove existing modal if any
            const existingModal = document.getElementById('chartModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // Add new modal
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('chartModal'));
            modal.show();
        }
    </script>
</body>
</html>